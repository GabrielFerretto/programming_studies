# üêß Linux aula 02 pt-01

# Gerenciamento de Processos

*Um programa de computador √© algo, adormecido em um disco r√≠gido de um equipamento. Quando chamamos um comando ou clicamos em um lan√ßador de programa em uma interface gr√°fica, ele se torna um processo. Ou seja, um processo √© um programa em execu√ß√£o.*

*No entanto, em alguns momentos, processos podem travar ou consumir recursos demais de uma m√°quina. Os comandos a seguir permitem a um administrador monitorar os processos em andamento, verificando o consumo de recursos e podendo, at√© mesmo, destruir processos.*

<hr>
<br>

### **PS** - Listar Processos

*O comando **"ps"** permite listar os processos atuais de um sistema e √©, geralmente, acompanhado pelos par√¢metros: **"-a"**, que mostra os processos de todos os usu√°rios (permiss√£o de root para tal), **"-u"**, que exibe uma lista detalhada contendo o usu√°rio dono do processo e **"-x"**, que exibe processos que n√£o estejam associados ao terminal de comandos (pois cada processo tem uma origem, ao usar o par√¢metro, podemos ver processos da interface gr√°fica por exemplo, que √© considerada outro terminal).*

```sh
  ps -au
```

<img src="../img/ps01.png">
<br>
<hr>

### **TOP** - Monitor de Processos

*O comando **"top** n√£o √© apenas um monitor de processos, ele permite obter informa√ß√µes importantes, como o total de  processos em andamento, seus estados no momento (executando, em espera, parados e zombies), uso de CPU, mem√≥ria RAM e mem√≥ria de SWAP.*

```sh
  top
```

<img src="../img/top01.gif">

*Encabe√ßando a lista, est√£o sempre os processos que consomem mais recursos do sistema.*

*Para sair do comando **"top"**(ele trava o terminal), digite **"q"**(quit,sair).*

<hr>
<br>

### **KILL e KILLALL** - Matando Processos

*Eventualmente, um administrador de sistema precisa interromper processos em andamento de maneira abrupta, seja por estarem consumindo recursos indesejados, seja lpor representarem algum risco ao sistema.*

*Para demonstrar seu funcionamento, aproveitei a interface gr√°fica e abro o aplicativo gnome-chess, que faz parte do pacote padr√£o para desktop do Ubuntu.*

*Caso n√£o esteja instalado o **gnome-chess**:*

```sh
  sudo apt install gnome-chess 
```

*Trata-se de um bom momento para demonstrar a possibilidade de combinar comandos: a execu√ß√£o do comando **"ps"**, especialmente com os par√¢metros **"-aux"**, pode ficar longa e confusa. O simbolo **"|"**(ou pipe) permite combinar um comando a outro. Observe o que acontece quando combino o comando **"ps -aux"** com o comando **"grep"**, que permite busca por palavras-chave:*

```sh
  ps -aux
```

<img src="../img/psaux.png">
<hr>
<br>
<br>

```sh
  ps -aux | grep gnome-chess
```

<img src="../img/psauxgp.png">

*A lista de processos mostra apenas duas linhas: o processo gnome-chess e a pr√≥pria execu√ß√£o do comando **grep** (que, afinal, possui a palavra-chave).*

<br>

*Para "matar" o processo gnome-chess, usamos o sugestivo comndo **kill**(que em ingl√™s significa "matar"), acompanhado do indentificador do processo (PID), informado na segunda coluna do comando  **ps -aux**.*

<br>

*Matando o processo:*

```sh
  kill PID 
```

<img src="../img/kill01.gif">

*Embora o comando se chame **kill**, ele pode ser utilizado para mandar sinais diferentes ao processo. Por exemplo, o uso do par√¢metro **-SIGSTOP** no comando **kill** n√£o destruiria o processo, apenas o pausaria ou congelaria. Sendo assim, um processo com a compress√£o de um arquivo (comando **tar**) que demorasse muito tempo n√£o precisaria ser necessariamente interrompido, caso precisasse liberar recursos de sistema. O par√¢metro **-SIGCONT** descongela o processo, que retoma seu processamento exatamente de onde parou.*

```sh
  kill -SIGSTOP PID
```

<br>

*H√° uma varia√ß√£o do comando **kill**, conhecido como **killall**(ou "matar todos"), que deve ser acompanhado pelo nome do processo (e n√£o o PID). Isso acontece pois, como sugere, o comando pode destruir todos os processos que possuam o mesmo nome.*


*Para a demonstra√ß√£o, usei o servidor web mais utilizado do mundo, o Apache Web Service; caso precise de um servidor web, n√£o deixe de instal√°-lo com o comando:*

```sh
  sudo apt install apache2
```

*O apache √© √∫til neste exemplo, pois como todo servi√ßo escalon√°vel, ele cria subprocessos conforme a necessidade de atender a muitas requisi√ß√µes de rede. Logo "de cara", seu processso principal gera outros dois processos, assim, temos tr√™s processos chamados apache2.*

<img src="../img/killall01.png">

*O primeiro comando:*

```sh
  sudo /etc/init.d/apache2 start
```
*√© a inicializa√ß√£o do daemon do apache2, o gerenciador de servi√ßo; ou seja, √© assim que um servi√ßo no Linux √© inicializado.*

*Ao executar:*

```sh
  ps -aux | grep apache2
```
*repare que possuo tr√™s processosm sendo um principal e dois subprocessos(embora n√£o saiba dizer qual √© qual). O comando:*

```sh
  killall apache2
```
*√© acompanhado pelo **sudo**, pois o servi√ßo pertence ao usu√°rio **www-data** e como podemos ver, ao listar os processos novamente, o comando faz servi√ßo sem deixar vest√≠gios.*

<img src="../img/killall02.gif">

*Outra forma de interromper processos √© fechar o terminal no qual eles rodam. Processos n√£o possuem apenas um usu√°rio dono, mas um terminal (seja ele gr√°fico ou n√£o) associado a eles.*